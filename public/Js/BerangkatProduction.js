const URL=document.getElementById("url").value,TOKEN=document.getElementById("token").value,BTN={update:document.getElementsByClassName("update"),uharga:document.getElementById("eharga"),uinduk:document.getElementById("einduk")},DATA_HARGA={id:0,harga:0},REGISTER={id:0,induk:""},FORM_ADD={wilayah:document.querySelector("select[name=wilayah]"),sangu:document.querySelector("input[name='sangu']"),berat:document.querySelector("input[name=berat_timbang]"),truk:document.querySelector("input[name=tara_mbl]"),netto:document.querySelector("input[name=netto]"),harga:document.querySelector("input[name=harga]"),petani:document.querySelector("select[name=nama_petani]"),tipe:document.getElementById("tipe"),no_induk:document.querySelector("input[name=no_induk]")},FORM_UPDATE={tgl_b:document.querySelector("input[name=utanggal_berangkat]"),tipe:document.querySelector("select[name=utipe]"),no_sp:document.querySelector("input[name=uno_sp]"),no_induk:document.querySelector("input[name=uno_induk]"),wilayah:document.querySelector("select[name=uwilayah]"),pemilik:document.querySelector("select[name=unama_petani]"),petani:document.querySelector("select[name=unama_sopir]"),pabrik:document.querySelector("select[name=upabrik_tujuan]"),sangu:document.querySelector("input[name=usangu]"),berat:document.querySelector("input[name=uberat_timbang]"),truk:document.querySelector("input[name=utara_mbl]"),netto:document.querySelector("input[name=unetto]"),harga:document.querySelector("input[name=uharga]")},setFunctionu=()=>{for(let t=0;t<BTN.update.length;t++)BTN.update[t].addEventListener("click",(function(){setForm(this.getAttribute("data-id"))}))};setFunctionu(),FORM_ADD.tipe.addEventListener("change",(function(){"SPT"===this.value?dForm(FORM_ADD):oForm(FORM_ADD)}));const dForm=t=>{t.sangu.readOnly=!0,t.berat.readOnly=!0,t.truk.readOnly=!0,t.netto.readOnly=!0},oForm=t=>{t.sangu.readOnly=!1,t.berat.readOnly=!1,t.truk.readOnly=!1,t.netto.readOnly=!1};FORM_UPDATE.tipe.addEventListener("change",(function(){"SPT"===this.value?dForm(FORM_UPDATE):oForm(FORM_UPDATE)})),FORM_ADD.berat.addEventListener("keyup",(function(){FORM_ADD.netto.value=this.value})),FORM_ADD.truk.addEventListener("keyup",(function(){const t=parseInt(FORM_ADD.berat.value)-parseInt(this.value);FORM_ADD.netto.value=t.toString()})),FORM_ADD.wilayah.addEventListener("change",(function(){fetch(URL+"/wilayah/getHarga/"+this.value).then((t=>t.json())).then((t=>updateHarga(t.data[0]))),"def"===this.value?BTN.uharga.disabled=!0:BTN.uharga.disabled=!1})),FORM_ADD.petani.addEventListener("change",(function(){fetch(URL+"/petani/getRegister/"+this.value).then((t=>t.json())).then((t=>updateRegister(t.data[0]))),"def"===this.value?BTN.uinduk.disabled=!0:BTN.uinduk.disabled=!1}));const updateHarga=t=>{null==t?FORM_ADD.harga.value="":(DATA_HARGA.id=t.id_wilayah,DATA_HARGA.harga=t.harga_wilayah,FORM_ADD.harga.value=DATA_HARGA.harga)},updateHargau=t=>{null==t?FORM_UPDATE.harga.value="":(DATA_HARGA.id=t.id_wilayah,DATA_HARGA.harga=t.harga_wilayah,FORM_UPDATE.harga.value=DATA_HARGA.harga)},updateRegister=t=>{null==t?FORM_ADD.no_induk.value="":(FORM_ADD.no_induk.value=t.register_pemilik,REGISTER.id=t.id_pemilik,REGISTER.induk=t.register_pemilik)};function filter(){try{getfilter()}catch(t){document.getElementById("list-data").innerHTML='<td colspan="6" style="text-align: center;">ERROR</td>'}}function getfilter(){const t=document.getElementById("date-range").value.split(" / "),e=t[0].split("-"),a=t[1].split("-"),n=`${e[2]}-${e[1]}-${e[0]}`,u=`${a[2]}-${a[1]}-${a[0]}`;fetch(`${URL}/filterberangkat`,{method:"post",body:JSON.stringify({tgl1:n,tgl2:u}),headers:{"Content-Type":"application/json","X-CSRF-Token":TOKEN}}).then((t=>t.json())).then((t=>{document.getElementById("list-data").innerHTML=parse(t),setFunctionu()}))}function setForm(t){const e=t;document.getElementById("form-update").setAttribute("action",URL+"/berangkat/"+e),fetch(URL+"/berangkat/view/get/"+e).then((t=>t.json())).then((t=>{FORM_UPDATE.tgl_b.value=formatInputUpdate(t.data.tanggal_keberangkatan),FORM_UPDATE.tipe.value=t.data.tipe,FORM_UPDATE.no_sp.value=t.data.no_sp,FORM_UPDATE.no_induk.value=t.data.no_induk,FORM_UPDATE.wilayah.value=t.data.wilayah,FORM_UPDATE.pemilik.value=t.data.nama_petani,FORM_UPDATE.petani.value=t.data.nama_sopir,FORM_UPDATE.pabrik.value=t.data.pabrik_tujuan,FORM_UPDATE.sangu.value=t.data.sangu,FORM_UPDATE.berat.value=t.data.berat_timbang,FORM_UPDATE.truk.value=t.data.tara_mbl,FORM_UPDATE.netto.value=t.data.netto,FORM_UPDATE.harga.value=t.data.harga,"SPT"===t.data.tipe?dForm(FORM_UPDATE):oForm(FORM_UPDATE)}))}FORM_UPDATE.wilayah.addEventListener("change",(function(){fetch(URL+"/wilayah/getHarga/"+this.value).then((t=>t.json())).then((t=>updateHargau(t.data[0])))})),BTN.uharga.onclick=async function(){const t=FORM_ADD.harga.value,e=await fetch(URL+`/wilayah/harga?id=${DATA_HARGA.id}&harga=${t}`);"sukses"===(await e.json()).status?toastr.success("sukses update harga","update harga"):toastr.error("gagal update harga","update harga")},BTN.uinduk.onclick=async function(){const t=FORM_ADD.no_induk.value,e=await fetch(URL+`/petani/induk?id=${REGISTER.id}&induk=${t}`);"sukses"===(await e.json()).data?toastr.success("sukses update nomor induk","update no induk"):toastr.error("gagal update nomor induk","update no induk")};const parse=t=>{let e="",a=1;return t.data.map((t=>{e+=htmldata(t,a++)})),e},htmldata=(t,e)=>`<tr>\n <td>${e}</td>\n <td>${formatTanggal(t.tanggal_keberangkatan)}</td>\n <td>${t.no_sp}</td>\n <td>${t.nama_petani}}</td>\n <td>${t.nama_sopir}</td>\n <td>${t.pabrik_tujuan}</td>\n <td>${t.no_induk}</td>\n <td>${t.wilayah}</td>\n <td>${formatRupiah(t.harga.toString(),"Rp ")}</td>\n <td style="text-align: center;">\n <button type="button" class="btn btn-success text-bold update" data-toggle="modal" data-target="#exampleModal" data-id="${t.id_keberangkatan}">\n <i class="fas fa-pencil-alt"></i>&nbsp;Ubah</button>\n <a href="${URL}/berangkat/${t.id_keberangkatan}" class="btn btn-danger text-bold"><i class="far fa-trash-alt"></i>&nbsp;Hapus</a>\n </td>\n</tr>`,formatTanggal=t=>{const e=t.split("-");return`${e[2]}/${["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","November","Desember"][parseInt(e[1])-1]}/${e[0]}`},formatRupiah=(t,e)=>{var a=t.replace(/[^,\d]/g,"").toString().split(","),n=a[0].length%3,u=a[0].substr(0,n),r=a[0].substr(n).match(/\d{3}/gi);return r&&(separator=n?".":"",u+=separator+r.join(".")),u=null!=a[1]?u+","+a[1]:u,null==e?u:u?"Rp. "+u:""};function formatInputUpdate(t){const e=t.split("-");return`${e[2]}/${e[1]}/${e[0]}`}